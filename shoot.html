<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>üöÄ Bullet‚ÄëShooter (HTML5 Canvas)</title>
    <style>
        /* --- Layout --------------------------------------------------- */
        html,body {margin:0;padding:0;height:100%;overflow:hidden;background:#111;}
        canvas {display:block;margin:auto;background:#001;cursor:none;}
        /* --- HUD ------------------------------------------------------ */
        #hud {
            position:absolute;top:10px;left:10px;color:#fff;font:16px monospace;
            text-shadow:0 0 5px #0ff;
        }
        #msg {
            position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
            color:#ff0;font:24px monospace;text-align:center;
            text-shadow:0 0 8px #ff0;pointer-events:none;
        }
    </style>
</head>
<body>
<canvas id="c"></canvas>
<div id="hud">Score: <span id="score">0</span></div>
<div id="msg"></div>

<script>
/*=====================================================================
   Bullet‚ÄëShooter ‚Äì vanilla JavaScript (ES6)
   ‚Ä¢ ƒêi·ªÅu khi·ªÉn: ‚Üê / ‚Üí ho·∫∑c A / D ‚Äì di chuy·ªÉn
   ‚Ä¢ B·∫Øn: Space ho·∫∑c Click chu·ªôt tr√°i
   ‚Ä¢ ESC ƒë·ªÉ tho√°t (ƒë√≥ng tab)
   ‚Ä¢ Khi ennemies ch·∫°m ƒë√°y ‚Üí GAME OVER
=====================================================================*/

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;

//--- K√≠ch th∆∞·ªõc canvas responsive ---------------------------------------
function resize() {
    W = canvas.width  = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

//--- ƒê·ªëi t∆∞·ª£ng chung ----------------------------------------------------
class Entity {
    constructor(x,y,w,h) { this.x=x; this.y=y; this.w=w; this.h=h; }
    draw() {}          // override
    update(dt) {}      // override
    collide(other) {
        return !(this.x+this.w < other.x ||
                 this.x > other.x+other.w ||
                 this.y+this.h < other.y ||
                 this.y > other.y+other.h);
    }
}

//--- Player -------------------------------------------------------------
class Player extends Entity {
    constructor() {
        super(W/2-20, H-80, 40, 40);
        this.speed = 400;   // pixel / s
        this.cool = 0;      // time since last shot
    }
    draw() {
        ctx.fillStyle = '#0ff';
        ctx.beginPath();
        ctx.moveTo(this.x, this.y+this.h);
        ctx.lineTo(this.x+this.w/2, this.y);
        ctx.lineTo(this.x+this.w, this.y+this.h);
        ctx.closePath();
        ctx.fill();
    }
    update(dt, input) {
        if (input.left)  this.x -= this.speed*dt;
        if (input.right) this.x += this.speed*dt;
        // gi·ªõi h·∫°n trong screen
        this.x = Math.max(0, Math.min(W-this.w, this.x));
        this.cool -= dt;
    }
    canShoot() { return this.cool <= 0; }
    shoot() {
        this.cool = 0.18;               // 5.5 b·∫Øn/s
        return new Bullet(this.x+this.w/2, this.y);
    }
}

//--- Bullet ------------------------------------------------------------
class Bullet extends Entity {
    constructor(x,y) {
        super(x-3, y-12, 6, 12);
        this.speed = 600;
    }
    draw() {
        ctx.fillStyle = '#ff0';
        ctx.fillRect(this.x, this.y, this.w, this.h);
    }
    update(dt) {
        this.y -= this.speed*dt;
    }
    out() { return this.y+this.h < 0; }
}

//--- Enemy -------------------------------------------------------------
class Enemy extends Entity {
    constructor() {
        const size = 40;
        const x = Math.random()*(W-size);
        const y = -size;
        super(x, y, size, size);
        this.speed = 80 + Math.random()*120;   // 80‚Äë200
    }
    draw() {
        ctx.fillStyle = '#f44';
        ctx.fillRect(this.x, this.y, this.w, this.h);
    }
    update(dt) { this.y += this.speed*dt; }
    out() { return this.y > H; }
}

//--- Input handling ----------------------------------------------------
const input = {left:false,right:false,shoot:false};
window.addEventListener('keydown', e=>{
    if (e.code==='ArrowLeft'||e.key==='a') input.left = true;
    if (e.code==='ArrowRight'||e.key==='d') input.right = true;
    if (e.code==='Space') input.shoot = true;
    if (e.code==='Escape') window.close();
});
window.addEventListener('keyup', e=>{
    if (e.code==='ArrowLeft'||e.key==='a') input.left = false;
    if (e.code==='ArrowRight'||e.key==='d') input.right = false;
    if (e.code==='Space') input.shoot = false;
});
window.addEventListener('mousedown', e=>{ if(e.button===0) input.shoot = true; });
window.addEventListener('mouseup',   e=>{ if(e.button===0) input.shoot = false; });

//--- Game state --------------------------------------------------------
let player = new Player();
let bullets = [];
let enemies = [];
let spawnTimer = 0;
let score = 0;
let gameOver = false;
const scoreEl = document.getElementById('score');
const msgEl   = document.getElementById('msg');

//--- Main loop ---------------------------------------------------------
let last = performance.now();
function loop(now){
    const dt = (now-last)/1000;   // seconds
    last = now;
    if(!gameOver) update(dt);
    render();
    requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

//--- Update ------------------------------------------------------------
function update(dt){
    // 1. Player
    player.update(dt, input);
    if (input.shoot && player.canShoot()){
        bullets.push(player.shoot());
    }

    // 2. Bullets
    for(let i=bullets.length-1;i>=0;i--){
        bullets[i].update(dt);
        if(bullets[i].out()) bullets.splice(i,1);
    }

    // 3. Enemies (spawn)
    spawnTimer -= dt;
    if(spawnTimer<=0){
        enemies.push(new Enemy());
        spawnTimer = 0.7 + Math.random()*0.8;   // 0.7‚Äë1.5s
    }

    // 4. Enemies movement
    for(let i=enemies.length-1;i>=0;i--){
        enemies[i].update(dt);
        if(enemies[i].out()){
            endGame(); break;
        }
    }

    // 5. Collision bullet‚Äëenemy
    for(let i=bullets.length-1;i>=0;i--){
        const b = bullets[i];
        for(let j=enemies.length-1;j>=0;j--){
            const e = enemies[j];
            if(b.collide(e)){
                // explosion effect (tiny particles)
                for(let p=0;p<12;p++){
                    const angle = Math.random()*2*Math.PI;
                    const speed = 80+Math.random()*120;
                    particles.push({
                        x:e.x+e.w/2, y:e.y+e.h/2,
                        dx:Math.cos(angle)*speed,
                        dy:Math.sin(angle)*speed,
                        life:0.3,
                        size:2+Math.random()*2
                    });
                }
                bullets.splice(i,1);
                enemies.splice(j,1);
                score += 10;
                scoreEl.textContent = score;
                break;
            }
        }
    }

    // 6. Particles (explosions)
    for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.x += p.dx*dt;
        p.y += p.dy*dt;
        p.life -= dt;
        if(p.life<=0) particles.splice(i,1);
    }
}

//--- Render ------------------------------------------------------------
function render(){
    // clear
    ctx.clearRect(0,0,W,H);

    // player
    player.draw();

    // bullets
    bullets.forEach(b=>b.draw());

    // enemies
    enemies.forEach(e=>e.draw());

    // particles (simple circles)
    particles.forEach(p=>{
        ctx.fillStyle = `rgba(255,160,0,${p.life/0.3})`;
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.size,0,2*Math.PI);
        ctx.fill();
    });

    // Game‚Äëover overlay
    if(gameOver){
        ctx.fillStyle = 'rgba(0,0,0,0.6)';
        ctx.fillRect(0,0,W,H);
        ctx.fillStyle = '#ff0';
        ctx.font = '48px monospace';
        ctx.textAlign = 'center';
        ctx.fillText('GAME OVER', W/2, H/2-30);
        ctx.font = '24px monospace';
        ctx.fillText('Press F5 / Reload ƒë·ªÉ ch∆°i l·∫°i', W/2, H/2+20);
    }
}

//--- Game over ---------------------------------------------------------
function endGame(){
    gameOver = true;
    msgEl.textContent = `Score: ${score}`;
}

//--- Simple particle system ---------------------------------------------
let particles = [];

</script>
</body>
</html>
